# Wyly プロジェクトガイド

## プロジェクト概要

wylyは、複数のサービスから構成されるモノレポプロジェクトだ。

## ディレクトリ構造

- **app-web** Webアプリ

## Git運用

- **メインブランチ**: `main`
- **フィーチャーブランチ**: `feature/[機能名]`
- **修正ブランチ**: `fix/[修正内容]`

### コミットメッセージ規約

#### コミットの性質

コミットメッセージには以下のプレフィクスを必ず付けなければならない。

- `feat:` 機能追加・変更全般
- `ci:` CIの変更
- `fix:` バグ修正
- `docs:` ドキュメントやコメントの修正
- `refactor:` リファクタ（機能に一切変更がないもの）
- `test:` テストコードの変更
- `style:` lint、formatの修正
- `build:` ビルドシステムや依存パッケージに関する修正
- `perf:` パフォーマンス向上
- `ai:` AIへの指示や設定に関する変更(CLAUDE.mdの修正など)

#### コミットのスコープ

コミットが扱う対象に応じて、プレフィクスに補足を加えるべきだ。
例: `feat(app-web)`

ただし、全体に関わるコミットについてはスコープを明示する必要はない。

## SOWの作成

各サービス配下に .sow ディレクトリを作り、その配下にmarkdownでSOWを記載する。

## Claude Codeによる自動コミット

### 基本ルール

1. **コミット粒度**
   - 作業単位でコミット（例：コンポーネント追加、バグ修正、設定変更）
   - 関連する変更はまとめ、無関係な変更は分離

2. **コミット前処理**
   - 必ずリンター・フォーマッターを実行
   - エラーがある場合は修正してからコミット
   - .gitignoreの確認を徹底

3. **確認プロセス**
   - 初回コミット：必ず差分を提示して確認を求める
   - 2回目以降：大規模変更や設定ファイル変更時のみ確認
   - セキュリティリスクがある場合は必ず確認

4. **ブランチ運用**
   - mainブランチでの作業開始を検知したら即座に警告
   - ブランチ作成はユーザーが実施
   - pushは絶対に実行しない（ローカルコミットのみ）

5. **コミットメッセージ**
   - プレフィクス + スコープ + 内容 + 理由
   - 例：`feat(app-web): 投稿フォームコンポーネントを追加 - ユーザーが画像とテキストを投稿できるようにするため`
   - ユーザーの最終目的を理解した文脈で作成

### セキュリティ遵守事項

- 環境変数ファイル（.env*）は絶対にコミットしない
- APIキー、パスワード、トークンを含むファイルは確認
- 個人情報を含む可能性があるファイルは必ず確認を求める

### リンター・フォーマッター実行コマンド

app-web:

- `npm run lint` （存在する場合）
- `npm run format` （存在する場合）
- なければユーザーに確認

## GitHub Issue駆動開発フロー

### 概要
GitHub issueをベースにした自動開発フローを採用する。Claude Codeがissueの内容を読み取り、実装からPR作成まで自動で行う。

### スラッシュコマンド

1. **`/issue {番号}`** - issueを読み取って開発ブランチを作成
   - GitHub issueの内容を取得
   - feat/issue-{番号}-{簡潔な説明}形式でブランチ作成
   - issueの要件を理解して開発準備

2. **`/create-pr`** - 現在のブランチからPRを作成
   - lint・formatチェック実行
   - 変更をコミット
   - リモートにpush
   - PRを作成してURLを返す

3. **`/develop {番号}`** - issue読み取りからPR作成まで一括実行
   - issueベースで開発を完全自動化
   - 判断に迷う場合のみ確認を求める

### 開発フロー

1. ユーザーがGitHub issueを作成
2. `/issue {番号}` または `/develop {番号}` でClaude Codeに開発を依頼
3. Claude Codeが実装を進め、適切な粒度でコミット
4. 完了後、PRを作成（`/create-pr` または `/develop` の一部として）
5. ユーザーがPRを確認してマージ

### 注意事項

- issueには明確な要件と受け入れ条件を記載する
- セキュリティに関わる変更は必ず人間の確認を経る
- pushとPR作成は明示的な指示があった場合のみ実行される

## 重要な注意事項

- コミット前に必ずリントとフォーマットチェックを実行してください
- 新しいファイルを作成する前に、既存のファイルの修正で対応できないか検討してください
- コードスタイルは既存のコードに合わせてください
